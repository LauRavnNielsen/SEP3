@page "/createevent"
@attribute [Authorize(Policy = "MustBeLoggedIn")]
@using DiningApp.Data
@using System.Threading.Tasks

@using Microsoft.AspNetCore.Blazor.Services
@inject NavigationManager NavigationManager
@inject DiningApp.Data.IEventService EventService
@inject ToastService toastService

<h1 class="display-4">Create Event</h1>

<br style=“line-height:100;”>

<!-- Create event form -->
<div class="container">
    <EditForm Model="@newEvent" OnValidSubmit="@HandleValidSubmit">
        <DataAnnotationsValidator/>
        <ValidationSummary/>

        <!-- Location parameters -->
        <h6 class="display-5">Location</h6>
        <div class="form-group row">
            <div class="col-md-4">

                <InputText class="form-control" placeholder="City" id="city" @bind-Value="newEvent.City"/>
                           <small id="emailHelp" class="form-text text-muted"> * Required: Enter the city.</small>
                           </div>
                           <div class="col-md-4">
                               <InputNumber class="form-control" placeholder="Post code" id="postcode" @bind-Value="newEvent.PostCode"/>
                                            <small id="emailHelp" class="form-text text-muted">* Required: Enter the post code.</small>
                                            </div>
                                            <div class="col-md-4">
                                                <InputText class="form-control" placeholder="Street" id="street" @bind-Value="newEvent.Street"/>
                                                           <small id="emailHelp" class="form-text text-muted">* Required: Enter the street.</small>
                                                           </div>
                                                           </div>
                                                           <div class="form-group row">
                                                               <div class="col-md-4">
                                                                   <InputText class="form-control" placeholder="Block number" id="blocknumber" @bind-Value="newEvent.BlockNumber"/>
                                                                                <small id="emailHelp" class="form-text text-muted">Enter block number.</small>
                                                                                </div>

                                                                                <div class="col-md-4">
                                                                                    <InputNumber class="form-control" placeholder="Floor number" id="floornumber" @bind-Value="newEvent.FloorNumber"/>
                                                                                                 <small id="emailHelp" class="form-text text-muted">Enter floor number.</small>
                                                                                                 </div>

                                                                                                 <div class="col-md-4">
                                                                                                     <InputText class="form-control" placeholder="Flat number" id="flatnumber" @bind-Value="newEvent.FlatNumber"/>
                                                                                                                  <small id="emailHelp" class="form-text text-muted">* Required: Enter flat number.</small>
                                                                                                                  </div>
                                                                                                                  </div>

                                                                                                                  <!-- Date parameters -->
                                                                                                                  <h6 class="display-5">Date</h6>

                                                                                                                  <div class="form-group row">
                                                                                                                      <div class="col-md-4">
                                                                                                                          <InputText class="form-control" placeholder="Date" id="date" @bind-Value="newEvent.Date"/>
                                                                                                                                     <small id="emailHelp" class="form-text text-muted">* Required: Enter the date of your event.</small>
                                                                                                                                     </div>
                                                                                                                                     <div class="col-md-4">
                                                                                                                                         <InputText class="form-control" placeholder="Start" id="start" @bind-Value="newEvent.EventStart"/>
                                                                                                                                                    <small id="emailHelp" class="form-text text-muted">* Required: Enter the time your event starts.</small>
                                                                                                                                                    </div>
                                                                                                                                                    <div class="col-md-4">
                                                                                                                                                        <InputText class="form-control" placeholder="End" id="end" @bind-Value="newEvent.EventEnd"/>
                                                                                                                                                                   <small id="emailHelp" class="form-text text-muted">* Required: Enter the time your event ends.</small>
                                                                                                                                                                   </div>
                                                                                                                                                                   </div>


                                                                                                                                                                   <!-- Guests parameters -->
                                                                                                                                                                   <h6 class="display-5">Guests</h6>
                                                                                                                                                                   <div class="form-group row">
                                                                                                                                                                       <div class="col-md-4">
                                                                                                                                                                           <InputNumber class="form-control" placeholder="Number of guests" id="guests" @bind-Value="newEvent.NrOfGuests"/>
                                                                                                                                                                                        <small id="emailHelp" class="form-text text-muted">* Required: Enter the maximum number of guests allowed at your event.</small>
                                                                                                                                                                                        </div>
                                                                                                                                                                                        <div class="col-md-4">
                                                                                                                                                                                            <InputNumber class="form-control" placeholder="Age limit" id="agelimit" @bind-Value="newEvent.AgeLimit"/>
                                                                                                                                                                                                         <small id="emailHelp" class="form-text text-muted">Enter the age limit. </small>
                                                                                                                                                                                                         </div>
                                                                                                                                                                                                         </div>


                                                                                                                                                                                                         <div class="form-group row">
                                                                                                                                                                                                             <div class="col-md-4">
                                                                                                                                                                                                                 <label class="form-check-label" for="exampleCheck1">Do you own pets?</label>
                                                                                                                                                                                                                 <InputCheckbox class="form-control" placeholder="Pets" id="pets" @bind-Value="newEvent.Pets"/>

                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                </div>


                                                                                                                                                                                                                                <!-- Description parameters -->
                                                                                                                                                                                                                                <h6 class="display-5">Description</h6>

                                                                                                                                                                                                                                <div class="form-group row">
                                                                                                                                                                                                                                    <div class="col-md-5">
                                                                                                                                                                                                                                        <InputTextArea class="form-control" placeholder="Description" id="description" @bind-Value="newEvent.Description"/>
                                                                                                                                                                                                                                                       <small id="emailHelp" class="form-text text-muted">* Required: Write a short description of your event</small>
                                                                                                                                                                                                                                                       </div>
                                                                                                                                                                                                                                                       <div class="col-md-4">
                                                                                                                                                                                                                                                           <InputNumber class="form-control" placeholder="Entry" id="entry" @bind-Value="newEvent.EntryFee"/>
                                                                                                                                                                                                                                                                        <small id="emailHelp" class="form-text text-muted">Specify entry fee.</small>
                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                        </div>


                                                                                                                                                                                                                                                                        <div class="form-group row">
                                                                                                                                                                                                                                                                            <div class="col-md-4">
                                                                                                                                                                                                                                                                                <label class="form-check-label" for="exampleCheck1">Is entertainment included?</label>
                                                                                                                                                                                                                                                                                <InputCheckbox class="form-control" placeholder="Entertainment" id="entertainment" @bind-Value="newEvent.Entertainment"/>
                                                                                                                                                                                                                                                                                               </div>
                                                                                                                                                                                                                                                                                               </div>


                                                                                                                                                                                                                                                                                               <!-- Drinks parameters -->
                                                                                                                                                                                                                                                                                               <h6 class="display-5">Drinks</h6>
                                                                                                                                                                                                                                                                                               <div class="form-group row">
                                                                                                                                                                                                                                                                                                   <div class="col-md-4">
                                                                                                                                                                                                                                                                                                       <label class="form-check-label" for="exampleCheck1">Are drinks included?</label>
                                                                                                                                                                                                                                                                                                       <InputCheckbox class="form-control" placeholder="Drinks" id="drinks" @bind-Value="newEvent.Drinks"/>
                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                      </div>


                                                                                                                                                                                                                                                                                                                      <!-- Food parameters -->
                                                                                                                                                                                                                                                                                                                      <h6 class="display-5">Food</h6>

                                                                                                                                                                                                                                                                                                                      <div class="form-group row">
                                                                                                                                                                                                                                                                                                                          <div class="col-md-4">

                                                                                                                                                                                                                                                                                                                              <InputText class="form-control" placeholder="Starter" id="starter" @bind-Value="newEvent.Starter"/>
                                                                                                                                                                                                                                                                                                                                         <small id="emailHelp" class="form-text text-muted">Enter starter information</small>
                                                                                                                                                                                                                                                                                                                                         </div>
                                                                                                                                                                                                                                                                                                                                         <div class="col-md-4">
                                                                                                                                                                                                                                                                                                                                             <InputText class="form-control" placeholder="Main course" id="main" @bind-Value="newEvent.MainCourse"/>
                                                                                                                                                                                                                                                                                                                                                        <small id="emailHelp" class="form-text text-muted"> * Required: Enter main course information</small>
                                                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                                                        <div class="col-md-4">
                                                                                                                                                                                                                                                                                                                                                            <InputText class="form-control" placeholder="Desert" id="desert" @bind-Value="newEvent.Dessert"/>
                                                                                                                                                                                                                                                                                                                                                                       <small id="emailHelp" class="form-text text-muted"> Enter desert information</small>
                                                                                                                                                                                                                                                                                                                                                                       </div>
                                                                                                                                                                                                                                                                                                                                                                       </div>


                                                                                                                                                                                                                                                                                                                                                                       <br style=“line-height:100;”>

                                                                                                                                                                                                                                                                                                                                                                       <!-- Button section -->

                                                                                                                                                                                                                                                                                                                                                                       @if (confirm == true)
                                                                                                                                                                                                                                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                           <div class="row">
                                                                                                                                                                                                                                                                                                                                                                               <div class="col-md-12 p-3 mb-2 bg-warning text-dark">
                                                                                                                                                                                                                                                                                                                                                                                   Confirm that entered information is correct
                                                                                                                                                                                                                                                                                                                                                                               </div>
                                                                                                                                                                                                                                                                                                                                                                           </div>
                                                                                                                                                                                                                                                                                                                                                                           <button class="btn btn-primary" @onclick="HandleValidSubmit">Create</button>
                                                                                                                                                                                                                                                                                                                                                                           <button class="btn btn-primary" @onclick="Cancel">Cancel</button>
                                                                                                                                                                                                                                                                                                                                                                       }
                                                                                                                                                                                                                                                                                                                                                                       else
                                                                                                                                                                                                                                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                           <button class="btn btn-primary" @onclick="Save">Create</button>
                                                                                                                                                                                                                                                                                                                                                                           <button class="btn btn-primary" @onclick="Cancel">Cancel</button>
                                                                                                                                                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                                                                                                                                                                   </EditForm>
                                                                                                                                                                                                                                                                                                                                                                                   </div>


                                                                                                                                                                                                                                                                                                                                                                                   @code {
                                                                                                                                                                                                                                                                                                                                                                                       private Event newEvent = new Event();
                                                                                                                                                                                                                                                                                                                                                                                       public bool confirm { get; set; }

                                                                                                                                                                                                                                                                                                                                                                                       async Task HandleValidSubmit()
                                                                                                                                                                                                                                                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                                           await Create();
                                                                                                                                                                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                                                                                                                                                                       async Task Create()
                                                                                                                                                                                                                                                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                                           Console.WriteLine("[INFO]***********************************CREATE clicked");
                                                                                                                                                                                                                                                                                                                                                                                           newEvent.UserId = 0;
                                                                                                                                                                                                                                                                                                                                                                                       // DummyEventService.PostNewEvent(newEvent);
                                                                                                                                                                                                                                                                                                                                                                                       //EventService service = new EventService();
                                                                                                                                                                                                                                                                                                                                                                                       //await service.CreateNewEvent(newEvent);

                                                                                                                                                                                                                                                                                                                                                                                           await EventService.CreateNewEvent(newEvent);

                                                                                                                                                                                                                                                                                                                                                                                           NavigationManager.NavigateTo("searchevent");
                                                                                                                                                                                                                                                                                                                                                                                          // toastService.Dispose();
                                                                                                                                                                                                                                                                                                                                                                                           toastService.ShowToast("The event has been created", ToastLevel.Success);
                                                                                                                                                                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                                                                                                                                                                       void Cancel()
                                                                                                                                                                                                                                                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                                           NavigationManager.NavigateTo("searchevents");
                                                                                                                                                                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                                                                                                                                                                       void Save()
                                                                                                                                                                                                                                                                                                                                                                                       {
                                                                                                                                                                                                                                                                                                                                                                                           confirm = true;
                                                                                                                                                                                                                                                                                                                                                                                       }

                                                                                                                                                                                                                                                                                                                                                                                   }